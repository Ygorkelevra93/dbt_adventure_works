with fato as (
    select
PK_ID_ORDEM_DE_VENDA
,FK_ID_CLIENTE
,FK_ID_VENDEDOR
,FK_ID_TERRITORIO
,FK_ID_REQUISICAO_MATERIAL
,FK_ID_ENDERECO_ENTREGA
,FK_ID_TIPO_ENTREGA
,FK_ID_CARTAO_CLIENTE
,FK_ID_COTACAO_MOEDA
,FK_ID_PRODUTO
,FK_ID_CONDICAO_ESPECIAL_VENDA
,FCT_VENDAS_DATA_VENDA
,FCT_VENDAS_PRAZO_ENTREGA
,FCT_VENDAS_DATA_EMBARQUE
,FCT_VENDAS_DATA_ATT
,FCT_VENDAS_VALOR_BRUTO_IMPRESSO_NOTA
,FCT_VENDAS_VALOR_IMPOSTOS_NOTA
,FCT_VENDAS_VALOR_FRETE_NOTA
,FCT_VENDAS_VALOR_TOTAL_IMPRESSO_NOTA
,FCT_VENDAS_QUANTIDADE_PRODUTO
,FCT_VENDAS_PRECO_UNITARIO_VENDA
,FCT_VENDAS_PERCENTUAL_DESCONTO_APLICADO
,FCT_VENDAS_VALOR_TOTAL_NEGOCIADO
,FCT_VENDAS_VALOR_LIQUIDO_NEGOCIADO
,FCT_VENDAS_CUSTO_TOTAL_PRODUTO
,FCT_VENDAS_PRECO_UNITARIO_CUSTO
,FCT_VENDAS_MARGEM_LIQUIDA
,FCT_VENDAS_MARGEM_BRUTA
,FCT_VENDAS_NUMERO_REVISAO
,FCT_VENDAS_STATUS_VENDA
,FCT_VENDAS_STATUS_VENDA_NOME
,FCT_VENDAS_TIPO_VENDA
,FCT_VENDAS_ORDEM_COMPRA
,FCT_VENDAS_NUMERO_CONTA
,FCT_VENDAS_COD_APROV_CARTAO
,FCT_VENDAS_OBSERVACOES 
from {{ref("int_erp__fct_vendas")}}
),


produto as (
    select 
    PK_ID_PRODUTO
    ,PRODUTO_NOME
    ,PRODUTO_SUBCATEGORIA
    ,PRODUTO_CATEGORIA
    ,PRODUTO_DATA_PHASE_IN
    ,PRODUTO_DATA_PHASE_OUT
    ,PRODUTO_PRECO_UNITARIO_CUSTO
    ,PRODUTO_PRECO_LISTA
    from {{ref("int_erp__produtos")}}
)




select 
    produto.PRODUTO_CATEGORIA
    ,count(fato.pk_id_ordem_de_venda) as quantidade
    ,count(distinct fato.pk_id_ordem_de_venda) as quantidade2
    
 from fato
 left join produto on produto.PK_ID_PRODUTO = fato.FK_ID_PRODUTO
 group by 1